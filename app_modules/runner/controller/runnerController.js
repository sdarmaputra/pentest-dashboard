var express = require('express');
var path = require('path');
var bodyParser = require('body-parser');
var http = require('http');
var router = express.Router();
var scenario = loadModel('scenario');
var attack = loadModel('attack');
loadPenetrationModule('w3af');

var view_dirname = 'runner/views';
var data = [];
data.title = 'Attack List';
data.site_name = 'Pentest Dashboard';
data.layout = '../base_views/layouts/home_layout';
scenarioStatus = 'unavailable';

router.use(bodyParser.urlencoded({ extended: true }));

/* Run penetration test for certain scenario based on scenario ID */
router.get('/run/:id', function(req, res, next) {
  // scenario.update({runningStatus: 1}, {where: {id: req.params.id}}).then(function(){
    stopCurrentTest(req.params.id, function(){
        deleteCurrentTest(req.params.id, function(){
          startNewTest(req.params.id, function(data){
            res.render(path.join(view_dirname, 'run'));
          });
        });
    });
  // });
});

module.exports = router;
