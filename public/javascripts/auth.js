

var LoginBox = React.createClass({
  getInitialState: function() {
    return({
      username: '',
      password: ''});
  },
  handleUsernameChange: function(event) {
    this.setState({username: event.target.value});
  },
  handlePasswordChange: function(event) {
    this.setState({password: event.target.value});
  },
  handleLogin: function(){
    toastr.options.closeButton = true;
    if (this.state.username != "" && this.state.password != "") {
      $.ajax({
        url: this.props.authUrl,
        dataType: 'json',
        type:'POST',
        data: this.state,
        success: function(result) {
          if (result.status == "failed") {
            toastr.error(result.message);
          } else {
            var d = new Date();
            var exdays = 2;
            d.setTime(d.getTime() + (exdays*24*60*60*1000));
            var expires = "expires="+ d.toUTCString();
            document.cookie = "jwt="+ result.token +"; expires="+ expires;
            window.location.href = this.props.successRedirect;
          }
        }.bind(this),
        error: function(xhr, status, err) {
          console.error(this.props.authUrl, status, err.toString());
        }.bind(this)
      });  
    } else {
      toastr.error("Username and password must be filled!");
    }
  },
  componentDidMount: function() {
    $('#loadingContainer').fadeOut();
  },
  render: function() {
    return (
      <div className="row">
      <div className="col-md-4 col-md-offset-4 login-box">
        <div className="module-container">
          
            <center><h3>SIGN IN</h3></center>
            <div className="form-group">
              <label for="username">Username</label>
              <input type="text" className="form-control" id="username" name="username" placeholder="Username" value={this.state.username} onChange={this.handleUsernameChange}/>
            </div>
            <div className="form-group">
              <label for="password">Password</label>
              <input type="password" className="form-control" id="password" name="password" placeholder="Password"  value={this.state.password} onChange={this.handlePasswordChange}/>
            </div>
            <button type="submit" className="btn btn-success btn-block btn-large" onClick={this.handleLogin}>Sign In</button>
          
        </div>
      </div>
      </div>
    );
  }
});



var container = ReactDOM.render(<LoginBox authUrl="http://10.151.36.30:3000/auth" successRedirect="/home"/>, document.getElementById('container'));  