var StatusBox =  React.createClass({
  render: function() {
    return (
      <div>
        <center>
          <h3>Status: {this.props.status}</h3>
          <h3>State: {this.props.state}</h3>
        </center>
      </div>
    );
  }
});

var RunnerBox = React.createClass({
  getInitialState: function() {
    return {scanStatus: null};
  },
  componentDidMount: function(){
    $('#loadingContainer').fadeOut();
    $.ajax({
      url: this.props.runnerUrl,
      dataType: 'json',
      type: 'POST',
      success: function(data) {
        this.setState({scanStatus: data});
        $('#loadingRunner').fadeOut();
      }.bind(this),
      error: function(xhr, status, err) {
        console.error(this.props.url, status, err.toString());
      }.bind(this)
    });
  },
  render: function() {
    if (this.state.scanStatus == null) {
      var result = '';
    } else {
      var result = <StatusBox 
          status={this.state.scanStatus.status}
          state={this.state.scanStatus.state} />
    }
    return (
      <div className="module-container row">
        <div className="col-lg-12">
          <div id="loadingRunner" className="loading-container-in">
            <span className="helper"></span>
            <img className="loader" width="40" src="/bower_components/loading/loading-spinning-bubbles.svg" alt="Loading..." />
          </div>
          {result}
        </div>
      </div>
    );
  }
});

var Runner = React.createClass({
  render: function() {
    var scenarioId = $('#scenarioId').val();
    var runnerUrl = "http://10.151.36.30:3000/runner/run/" + scenarioId;
    
    return (
      <div>
        <PageTitle 
        iconClassName="glyphicon glyphicon-scale"
        primaryText="Scenario Runner"
        secondaryText="Scenario runner and scanning status"
        showBackButton={true}
        backButtonHref="http://10.151.36.30:4000/scenario" />
      
        <RunnerBox 
            scenarioId={scenarioId} 
            runnerUrl={runnerUrl}/>
      </div>
    );
  }
});



var container = ReactDOM.render(<Runner />, document.getElementById('container'));  