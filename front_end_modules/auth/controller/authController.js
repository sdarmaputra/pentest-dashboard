var express = require('express');
var path = require('path');
var bodyParser = require('body-parser');
var request = require('request');
var router = express.Router();

var view_dirname = 'auth/views';
var data = [];
data.title = 'Gate';
data.site_name = config.site_name;
data.layout = '../base_views/layouts/front_end_login_layout';

router.use(bodyParser.urlencoded({ extended: true }));

router.get('/', function(req, res, next) {
	res.render(path.join(view_dirname, 'index'), data);
});

router.get('/logout', function(req, res, next) {
	request.post({url:"http://10.151.36.30:3000/auth/logout", 
		form: {},
		headers: {
	    'Authorization': 'Bearer ' + req.cookies.jwt
	  	}},
		function(error, httpResponse, body){ 
		if (!error && httpResponse.statusCode == 200) {
			body = JSON.parse(body);
			if (body.status == 'success') {
				res.clearCookie('jwt');
				res.redirect('/auth');			
			} else {
				res.redirect('/home');			
			}
		} else {
			res.redirect('/home');
		}
	});	
});

module.exports = router;
