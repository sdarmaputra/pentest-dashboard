var express = require('express');
var path = require('path');
var bodyParser = require('body-parser');
var request = require('request-json');
var cookieParser = require('cookie-parser');
var router = express.Router();

var view_dirname = 'scenario/views';
var data = [];
data.title = 'Scenario';
data.site_name = config.site_name;
data.layout = '../base_views/layouts/front_end_layout';

var appSandboxUrl = "http://10.151.36.93:8000";
var pentestAgentUrl = "http://10.151.36.92:8000";
var appSandboxServer = request.createClient(appSandboxUrl);

router.use(bodyParser.urlencoded({ extended: true }));
router.use(cookieParser());
router.use(function(req, res, next) {
	checkJwt(req, res, next);
});

router.get('/', function(req, res, next) {
	res.render(path.join(view_dirname, 'index'), data);
});

router.get('/configs/:id', function(req, res, next) {
	data.urlData = "http://10.151.36.30:3000/scenario/" + req.params.id;
	data.urlUpdate = "http://10.151.36.30:3000/scenario/update/" + req.params.id;
	res.render(path.join(view_dirname, 'configs'), data);
});

router.get('/run/:id', function(req, res, next) {
	data.scenarioId = req.params.id;
	data.appSandboxDeployUrl = appSandboxUrl + '/deploy';
	data.pentestAgentGetUrl = pentestAgentUrl + '/run';
	data.pentestAgentScanUrl = pentestAgentUrl + '/scan';
	data.storeResultUrl = "http://10.151.36.30:3000/result/store";
	data.urlData = "http://10.151.36.30:3000/scenario/" + req.params.id;
	res.render(path.join(view_dirname, 'run'), data);
});

module.exports = router;
