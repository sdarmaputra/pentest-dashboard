var express = require('express');
var path = require('path');
var bodyParser = require('body-parser');
var request = require('request-json');
var router = express.Router();

var view_dirname = 'result/views';
var data = [];
data.title = 'Result';
data.site_name = config.site_name;
data.layout = '../base_views/layouts/front_end_layout';

router.use(bodyParser.urlencoded({ extended: true }));

router.get('/:token?', function(req, res, next) {
	if (req.params.token == undefined) {
		res.render(path.join(view_dirname, 'index'), data);
	} else {
		var tokenString = new Buffer(req.params.token, 'base64').toString('ascii');
		
		var jsonString = JSON.stringify(eval("(" + tokenString + ")"));
		var tokenValue = JSON.parse(jsonString);
		
		data.scenarioId = tokenValue.id;
		data.runningToken = req.params.token;
		res.render(path.join(view_dirname, 'resultByToken'), data);
	}
		
});


module.exports = router;
